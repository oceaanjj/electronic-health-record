function p(){if(!document.querySelector("#medication-administration-form"))return;const a=document.getElementById("patient_id_hidden"),i=document.getElementById("date_selector"),t=document.querySelectorAll(".medication-input"),u=document.getElementById("submit_button"),r={"10:00:00":0,"14:00:00":1,"18:00:00":2};function d(o){i.disabled=!o,t.forEach(n=>n.disabled=!o),u.disabled=!o}function s(){t.forEach(o=>o.value="")}function f(o){s(),o.forEach(n=>{const c=r[n.time];if(c!==void 0){const e=c*5;t[e]&&(t[e].value=n.medication||""),t[e+1]&&(t[e+1].value=n.dose||""),t[e+2]&&(t[e+2].value=n.route||""),t[e+3]&&(t[e+3].value=n.frequency||""),t[e+4]&&(t[e+4].value=n.comments||"")}})}async function m(){const o=a.value,n=i.value;if(!o||!n){s();return}try{const c=await fetch(`/medication-administration/records?patient_id=${o}&date=${n}`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const e=await c.json();f(e)}catch(c){console.error("Error fetching medication records:",c)}}a.value?(d(!0),m()):d(!1),i.addEventListener("change",()=>{a.value?m():s()})}document.addEventListener("DOMContentLoaded",()=>{p()});document.addEventListener("patient:cleared",()=>{if(!document.querySelector("#medication-administration-form"))return;const a=document.getElementById("date_selector"),i=document.querySelectorAll(".medication-input"),t=document.getElementById("submit_button");function u(d){a.disabled=!0,i.forEach(s=>s.disabled=!0),t.disabled=!0}function r(){i.forEach(d=>d.value="")}u(),r()});document.addEventListener("patient:selected",async l=>{const{patientId:a,selectUrl:i}=l.detail,t=document.getElementById("form-content-container"),u=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!(!t||!i||!a))try{const r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":u,"X-Requested-With":"XMLHttpRequest","X-Fetch-Form-Content":"true"},body:`patient_id=${encodeURIComponent(a)}`});if(!r.ok)throw new Error(`Server responded with status: ${r.status}`);const d=await r.text(),m=new DOMParser().parseFromString(d,"text/html").getElementById("form-content-container");if(m)t.innerHTML=m.innerHTML,typeof window.initSearchableDropdown=="function"&&window.initSearchableDropdown(),p();else throw new Error("Could not find '#form-content-container' in response.")}catch(r){console.error("Patient loading failed:",r),window.location.reload()}});
