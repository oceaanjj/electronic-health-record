const E=()=>{const c=document.querySelector(".searchable-dropdown");if(!c||c.dataset.initialized)return;c.dataset.initialized="true",c.style.position="relative",c.style.zIndex="60";const i=document.getElementById("patient_search_input"),s=document.getElementById("patient_id_hidden"),l=document.getElementById("patient_options_container");if(!i||!l)return;l.querySelectorAll(".option");const b=c.dataset.selectUrl;let u=-1;l.style.display="none";const f=()=>{l.querySelectorAll(".option").forEach(t=>{t.classList.remove("active")})},h=e=>{f();const t=Array.from(l.querySelectorAll(".option")).filter(n=>n.style.display!=="none");t.length!==0&&(e>=t.length&&(e=0),e<0&&(e=t.length-1),u=e,t[u].classList.add("active"),t[u].scrollIntoView({block:"nearest",behavior:"smooth"}))},w=()=>{const e=i.value.toLowerCase();let t=0;l.querySelectorAll(".option").forEach(r=>{const a=(r.textContent||r.innerText).toLowerCase().includes(e);r.style.display=a?"block":"none",a&&t++}),u=-1,f(),t>0?l.style.display="block":l.style.display="none"};i.addEventListener("focus",w),i.addEventListener("keyup",e=>{e.key!=="ArrowUp"&&e.key!=="ArrowDown"&&e.key!=="Enter"&&w()}),i.addEventListener("input",()=>{i.value===""&&(s&&(s.value=""),p(!0),g())});const m=e=>{if(!e)return;const t=e.getAttribute("data-value"),n=(e.textContent||e.innerText).trim();i.value=n,s&&(s.value=t),l.style.display="none",u=-1,f(),p(!1);const r=new CustomEvent("patient:selected",{bubbles:!0,detail:{patientId:t,selectUrl:b}});document.dispatchEvent(r)};i.addEventListener("keydown",e=>{const t=Array.from(l.querySelectorAll(".option")).filter(n=>n.style.display!=="none");if(e.key==="ArrowDown"||e.key==="ArrowUp"){e.preventDefault();const n=e.key==="ArrowDown"?1:-1;h(u+n)}else if(e.key==="Enter"){e.preventDefault();const n=l.querySelector(".option.active");n?m(n):t.length>0&&m(t[0])}}),l.addEventListener("click",e=>{const t=e.target.closest(".option");t&&m(t)});const p=e=>{const t=document.getElementById("form-content-container");let n=t?t.querySelector("form.cdss-form"):null;!n&&t&&(n=t.querySelector("form.relative")),!n&&t&&(n=t.querySelector("form"));const r=t?t.querySelector("fieldset"):null,d=document.getElementById("date_selector"),a=document.getElementById("day_no_selector");if(r&&(r.disabled=e),d&&(d.disabled=e),a&&(a.disabled=e),document.querySelectorAll(".vital-input").forEach(o=>{o.disabled=e}),n){const o=n.querySelector("button[type='submit']");o&&(o.disabled=e)}const y=document.querySelectorAll(".insert-btn"),A=document.querySelectorAll(".clear-btn");if(y.forEach(o=>{e?(o.classList.add("disabled"),o.setAttribute("disabled","true")):(o.classList.remove("disabled"),o.removeAttribute("disabled"))}),A.forEach(o=>{o.disabled=e}),n){let o=n.querySelector(".trigger-patient-alert");e?(o||(o=document.createElement("div"),o.className="trigger-patient-alert absolute inset-0 z-50 bg-transparent cursor-not-allowed",n.classList.contains("relative")||n.classList.add("relative"),n.appendChild(o)),o.style.display="block"):o&&(o.style.display="none")}},g=()=>{const e=document.getElementById("form-content-container");e&&(e.querySelectorAll("input, textarea, textarea.notepad-lines").forEach(r=>{r.type!=="hidden"&&(r.value=""),r.style.backgroundColor="",r.style.color=""}),e.querySelectorAll(".diagnostic-panel").forEach(r=>{const d=r.dataset.type,a=document.getElementById("preview-"+d);a&&(a.innerHTML="");const v=document.getElementById("uploaded-files-"+d);v&&(v.innerHTML="");const y=document.getElementById("file-input-"+d);y&&(y.value="")})),S()},S=()=>{document.querySelectorAll(".alert-box").forEach(t=>{t.innerHTML='<span class="opacity-70 text-white font-semibold text-center">NO ALERTS</span>',t.style.backgroundColor="",t.onclick=null})};s&&s.value===""?p(!0):p(!1)};window.searchableDropdownDocumentListener||(document.addEventListener("click",c=>{const i=document.querySelector(".searchable-dropdown");if(i&&!i.contains(c.target)){const s=document.getElementById("patient_options_container");s&&(s.style.display="none")}}),window.searchableDropdownDocumentListener=!0);document.addEventListener("DOMContentLoaded",()=>{E()});window.initSearchableDropdown=E;
