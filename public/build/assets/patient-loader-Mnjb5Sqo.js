window.patientSelectedListenerAttached||(window.patientSelectedListenerAttached=!0,document.addEventListener("patient:selected",async e=>{const{patientId:o,selectUrl:i}=e.detail,t=document.getElementById("form-content-container"),a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!t||!i||!o)return;const n=document.createElement("div");n.className="cute-loader-wrapper",n.innerHTML=`
            <div class="loader-card">
                <div class="logo-container">
                    <img src="img/loading.png" alt="Logo" class="shining-logo">
                </div>
                <span class="loading-text">One moment please...</span>
            </div>
        `,document.body.classList.add("is-loading"),document.body.appendChild(n);try{const r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},body:`patient_id=${encodeURIComponent(o)}`});if(!r.ok)throw new Error(`Status: ${r.status}`);const g=await r.text(),c=new DOMParser().parseFromString(g,"text/html"),l=c.getElementById("form-content-container"),m=l?l.innerHTML:null;if(!m)throw new Error("Content container missing in response");const s=c.querySelector("#vitals-form");let w=[],u={};if(s)try{w=JSON.parse(s.dataset.times||"[]");const d=s.dataset.fetchUrl,p=s.querySelector('input[name="patient_id"]')?.value,f=s.querySelector("#hidden_date_for_vitals_form")?.value,h=s.querySelector("#hidden_day_no_for_vitals_form")?.value;if(d&&p&&f){const y=await fetch(d,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":a,Accept:"application/json"},body:`patient_id=${encodeURIComponent(p)}&date=${encodeURIComponent(f)}&day_no=${encodeURIComponent(h)}`});y.ok&&(u=await y.json())}}catch(d){console.warn("Vitals processing failed",d)}t.style.transition="opacity 0.4s ease",t.style.opacity="0",setTimeout(()=>{n.style.transition="opacity 0.3s ease",n.style.opacity="0",setTimeout(()=>{n.remove(),document.body.classList.remove("is-loading"),t.innerHTML=m,requestAnimationFrame(()=>{t.style.opacity="1",v(w,u,i)})},300)},100)}catch(r){console.error("Patient loading failed:",r),n&&n.remove(),document.body.classList.remove("is-loading"),t.style.opacity="1"}}));function v(e,o,i){const t=document.getElementById("form-content-container");if(t){if(window.initializeVitalSignsCharts&&e.length>0&&window.initializeVitalSignsCharts(e,o,{animate:!0}),window.initializeChartScrolling&&window.initializeChartScrolling(),window.initializeSearchableDropdown&&window.initializeSearchableDropdown(),window.initializeVitalSignsDateSync&&window.initializeVitalSignsDateSync(),window.initializeDateDayLoader){const n=document.querySelector(".searchable-dropdown")?.dataset?.selectUrl||i;n&&window.initializeDateDayLoader(n)}window.colorizeAllVitals&&window.colorizeAllVitals(),document.dispatchEvent(new CustomEvent("cdss:form-reloaded",{bubbles:!0,detail:{formContainer:t}}))}}window.showPageLoader=function(){const e=document.createElement("div");return e.className="cute-loader-wrapper",e.innerHTML=`
        <div class="loader-card">
            <div class="logo-container">
                <img src="/img/loading.png" alt="Logo" class="shining-logo">
            </div>
            <span class="loading-text">One moment please...</span>
        </div>
    `,document.body.classList.add("is-loading"),document.body.appendChild(e),e};window.hidePageLoader=function(e){return new Promise(o=>{e.style.transition="opacity 0.3s ease",e.style.opacity="0",setTimeout(()=>{e.remove(),document.body.classList.remove("is-loading"),o()},300)})};document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("#mySidenav a[href]:not(#logout-btn)").forEach(o=>{o.addEventListener("click",function(i){if(this.classList.contains("bg-dark-green"))return;i.preventDefault();const t=this.getAttribute("href");window.showPageLoader();const a=document.getElementById("sidebarScroll");a&&sessionStorage.setItem("sidebar-scroll-pos",a.scrollTop),setTimeout(()=>{window.location.href=t},100)})})});
