window.initializeDateDayLoader=function(n){if(!n){const a=document.querySelector(".searchable-dropdown");n=a?a.dataset.selectUrl:null}const o=document.getElementById("form-content-container"),c=document.getElementById("date_selector"),l=document.getElementById("day_no_selector"),w=document.getElementById("patient_id_hidden"),t=async()=>{await new Promise(e=>setTimeout(e,0));const a=document.getElementById("patient_id_hidden"),p=document.getElementById("date_selector"),g=document.getElementById("day_no_selector"),m=a.value,y=p.value,u=g.value;if(!m||!y||!u){console.warn("Date/Day Loader: Cannot load data. Missing Patient ID, Date, or Day No.");return}const h=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),i=o.querySelector(".form-overlay");i&&(i.style.display="flex");try{const e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":h,"X-Requested-With":"XMLHttpRequest","X-Fetch-Form-Content":"true"},body:`patient_id=${encodeURIComponent(m)}&date=${encodeURIComponent(y)}&day_no=${encodeURIComponent(u)}`});if(!e.ok)throw new Error(`Server responded with status: ${e.status}`);const D=await e.text(),f=new DOMParser().parseFromString(D,"text/html").getElementById("form-content-container");if(f){o.innerHTML=f.innerHTML;const s=o.querySelector(".cdss-form");s&&(s.id==="vitals-form"&&typeof window.initializeVitalSignsAlerts=="function"?window.initializeVitalSignsAlerts():s.id==="io-form"&&typeof window.initializeIntakeOutputAlerts=="function"&&window.initializeIntakeOutputAlerts());const r=document.getElementById("date_selector"),d=document.getElementById("day_no_selector");r&&d&&(r.removeEventListener("change",t),d.removeEventListener("change",t),r.addEventListener("change",t),d.addEventListener("change",t),r.disabled=!1,d.disabled=!1)}else throw new Error("Could not find '#form-content-container' in response.")}catch(e){console.error("Date/Day loading failed:",e),i&&(i.style.display="none")}};if(!n||!(c&&l&&w&&o)){console.warn("Date/Day Loader: Missing required ADL elements or selectUrl. Not initializing date/day change listeners.");return}c.addEventListener("change",t),l.addEventListener("change",t)};
