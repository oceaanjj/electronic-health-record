document.addEventListener("patient:selected",async i=>{const{patientId:r,selectUrl:d}=i.detail,t=document.getElementById("form-content-container"),p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),s=document.getElementById("patient_search_input"),o=document.getElementById("date_selector"),a=document.getElementById("day_no_selector"),m=o&&a;if(!t||!d||!r){console.error("Intake/Output Patient Loader: Missing required data for fetch or patientId.",i.detail);return}const c=t.querySelector(".form-overlay");c&&(c.style.display="flex");try{const e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":p,"X-Requested-With":"XMLHttpRequest","X-Fetch-Form-Content":"true"},body:`patient_id=${encodeURIComponent(r)}`});if(!e.ok)throw new Error(`Server responded with status: ${e.status}`);const y=await e.text(),n=new DOMParser().parseFromString(y,"text/html"),l=n.getElementById("patient_search_input");if(s&&l&&(s.value=l.value),m){const f=n.getElementById("date_selector"),w=n.getElementById("day_no_selector");f&&(o.value=f.value,o.disabled=!1),w&&(a.value=w.value,a.disabled=!1)}const u=n.getElementById("form-content-container");if(u)t.innerHTML=u.innerHTML,typeof window.initSearchableDropdown=="function"&&window.initSearchableDropdown(),typeof window.initializeDateDayLoader=="function"&&window.initializeDateDayLoader(),typeof window.intakeOutputCdss=="function"?window.intakeOutputCdss():typeof window.intakeOutputCdss?.init=="function"&&window.intakeOutputCdss.init(),typeof window.initializeIntakeOutputDataLoader=="function"&&window.initializeIntakeOutputDataLoader(),document.dispatchEvent(new CustomEvent("cdss:form-reloaded",{bubbles:!0,detail:{formContainer:t}}));else throw new Error("Intake/Output Patient Loader: Could not find '#form-content-container' in response.")}catch(e){console.error("Intake/Output Patient loading failed:",e),window.location.reload()}});
