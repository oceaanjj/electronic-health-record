(function(a){let d="",E="",v="",i=new Map;function y(){const e=document.getElementById("form-content-container");e?(d=e.dataset.csrfToken,E=e.dataset.patientId,v=e.dataset.deleteAllUrlTemplate):console.error("Diagnostics container #form-content-container not found."),["xray","ultrasound","ct_scan","echocardiogram"].forEach(o=>i.set(o,[]))}function f(e){const t=document.querySelector(`.diagnostic-panel[data-type="${e}"]`);if(!t)return;const o=t.querySelector(`#prompt-${e}`),n=t.querySelector(`#uploaded-files-${e}`),r=i.get(e)?.length>0,l=n&&n.children.length>0;o&&(o.style.display=r||l?"none":"flex")}function C(e,t){const o=e.target,n=Array.from(o.files);if(n.length===0)return;const r=i.get(t)||[];i.set(t,[...r,...n]),u(t)}a.previewImages=C;function u(e){const t=i.get(e),o=document.getElementById("preview-"+e),n=document.getElementById("file-input-"+e);o.innerHTML="";const r=new DataTransfer;if(!t||t.length===0){n.files=r.files,f(e);return}t.forEach((l,c)=>{r.items.add(l);const p=new FileReader;p.onload=T=>{const g=document.createElement("div");g.classList.add("preview-item"),g.innerHTML=`
                    <img src="${T.target.result}" alt="preview">
                    <button 
                        type="button" 
                        class="delete-btn" 
                        onclick="handleDeletePreview(event, '${e}', ${c})">
                        &times;
                    </button>
                `,o.appendChild(g)},p.readAsDataURL(l)}),n.files=r.files,setTimeout(()=>f(e),100)}function S(e,t,o){e.preventDefault(),e.stopPropagation();const n=i.get(t);n&&(n.splice(o,1),i.set(t,n),u(t))}a.handleDeletePreview=S;function D(e){i.set(e,[]),u(e)}a.clearPreview=D;function L(e){const t=document.querySelector(`.diagnostic-panel[data-type="${e}"]`);if(!t)return;const o=JSON.parse(t.dataset.uploadedImageIds||"[]"),n=i.get(e)||[];o.length>0?B(e,o):n.length>0&&D(e)}a.handleClearButtonClick=L;function I(){document.querySelectorAll(".panel-upload-area").forEach(n=>{["dragenter","dragover","dragleave","drop"].forEach(r=>{n.addEventListener(r,t,!1)}),["dragenter","dragover"].forEach(r=>{n.addEventListener(r,()=>n.classList.add("drag-over"),!1)}),["dragleave","drop"].forEach(r=>{n.addEventListener(r,()=>n.classList.remove("drag-over"),!1)}),n.addEventListener("drop",o,!1)});function t(n){n.preventDefault(),n.stopPropagation()}function o(n){const l=n.dataTransfer.files,c=n.currentTarget.dataset.type;document.getElementById(`file-input-${c}`)&&l.length>0&&C({target:{files:l}},c)}}function A(e,t){e.preventDefault(),e.stopPropagation(),typeof a.showConfirm=="function"?a.showConfirm("Do you really want to delete this image?","Delete Image?","Yes, delete","Cancel").then(o=>{o.isConfirmed&&m(t)}):typeof a.Swal=="function"?a.Swal.fire({title:"Delete Image?",text:"Do you really want to delete this image?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete",cancelButtonText:"Cancel",confirmButtonColor:"#2A1C0F",cancelButtonColor:"#6c757d"}).then(o=>{o.isConfirmed&&m(t)}):confirm("Delete this image?")&&m(t)}a.deleteImage=A;function m(e){fetch(e,{method:"POST",headers:{"X-CSRF-TOKEN":d,"X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams({_method:"DELETE"})}).then(t=>{t.ok?location.reload():s()}).catch(()=>s())}function B(e,t){const o=v.replace("__TYPE__",e).replace("__PATIENT_ID__",E),n="Do you really want to delete ALL images for "+e.toUpperCase()+"?",r="Delete All Images?";typeof a.showConfirm=="function"?a.showConfirm(n,r,"Yes","Cancel").then(l=>{l.isConfirmed&&h(o,t)}):typeof a.Swal=="function"?a.Swal.fire({title:r,text:n,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",confirmButtonColor:"#2A1C0F",cancelButtonColor:"#6c757d"}).then(l=>{l.isConfirmed&&h(o,t)}):confirm(n)&&h(o,t)}function h(e,t){fetch(e,{method:"POST",headers:{"X-CSRF-TOKEN":d,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({_method:"DELETE",image_ids:t})}).then(o=>o.json()).then(o=>{o.success?location.reload():s()}).catch(()=>s())}function s(){typeof a.showError=="function"?a.showError("Failed to delete image(s).","Error"):alert("Failed to delete image(s).")}document.addEventListener("DOMContentLoaded",()=>{y(),a.initSearchableDropdown&&a.initSearchableDropdown(),I(),["xray","ultrasound","ct_scan","echocardiogram"].forEach(t=>{f(t)})})})(window);
