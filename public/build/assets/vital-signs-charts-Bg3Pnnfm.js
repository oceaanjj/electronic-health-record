window.vitalCharts={tempChart:null,hrChart:null,rrChart:null,bpChart:null,spo2Chart:null};window.modalChartInstance=null;window.initializeVitalSignsCharts=function(t,e,o={}){const{animate:d=!0}=o;Object.keys(window.vitalCharts).forEach(n=>{window.vitalCharts[n]&&(window.vitalCharts[n].destroy(),window.vitalCharts[n]=null)});const s={temperature:"#d32f2f",hr:"#1976d2",rr:"#388e3c",bp:"#7b1fa2",spo2:"#f57c00"},r={temperature:{label:"Temp (°C)",elementId:"tempChart",field:"temperature",chartKey:"tempChart"},hr:{label:"HR (bpm)",elementId:"hrChart",field:"hr",chartKey:"hrChart"},rr:{label:"RR (bpm)",elementId:"rrChart",field:"rr",chartKey:"rrChart"},bp:{label:"BP (mmHg)",elementId:"bpChart",field:"bp",chartKey:"bpChart"},spo2:{label:"SpO₂ (%)",elementId:"spo2Chart",field:"spo2",chartKey:"spo2Chart"}},c=n=>{if(!n)return"";const a=n.split(":"),i=parseInt(a[0],10),f=(i+11)%12+1,p=i>=12?"PM":"AM";return`${f}:${a[1]} ${p}`},l=t.map(c);Object.entries(r).forEach(([n,a])=>{const i=document.getElementById(a.elementId);if(!i)return;const f=i.getContext("2d"),p=t.map(u=>{const m=e?.[u]?.[a.field];return m==null||m===""?null:parseFloat(m)}),y=new Chart(f,{type:"line",data:{labels:l,datasets:[{label:a.label,data:p,borderColor:s[n],backgroundColor:s[n],borderWidth:1.5,tension:.3,pointRadius:2,pointHoverRadius:5,fill:!1,spanGaps:!0}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,bottom:5,left:5,right:10}},animation:d?{duration:400}:!1,plugins:{legend:{display:!0,position:"top",align:"end",labels:{boxWidth:8,usePointStyle:!0,font:{size:10,weight:"600"}}},tooltip:{enabled:!0,bodyFont:{size:10}}},scales:{x:{grid:{display:!1},ticks:{font:{size:9},maxTicksLimit:6}},y:{beginAtZero:!1,grid:{color:"rgba(0,0,0,0.03)"},ticks:{font:{size:9}},beginAtZero:!1,grace:"10%"}}}});i.style.cursor="zoom-in",i.onclick=()=>{window.openChartModal(n,l,p,a.label,s[n])},window.vitalCharts[a.chartKey]=y,document.querySelectorAll(`input[data-field-name="${a.field}"]`).forEach(u=>{const m=u.cloneNode(!0);u.parentNode.replaceChild(m,u),m.addEventListener("input",()=>{const w=m.getAttribute("data-time"),b=parseFloat(m.value)||null,C=t.indexOf(w);C!==-1&&window.vitalCharts[a.chartKey]&&(window.vitalCharts[a.chartKey].data.datasets[0].data[C]=b,window.vitalCharts[a.chartKey].update("none"))})})})};function g(t,e){window.closeNav(),setTimeout(()=>{const o=document.getElementById("chart-modal"),d=o.querySelector("div"),s=document.getElementById("modal-chart-title"),r=document.getElementById(t),c=document.getElementById("modalChartCanvas");if(!r||!o)return;s.innerText=e,d.classList.remove("modal-reveal"),d.offsetWidth,d.classList.add("modal-reveal"),o.style.display="flex",modalChartInstance&&modalChartInstance.destroy();const l=Chart.getChart(r);l&&(modalChartInstance=new Chart(c,{type:l.config.type,data:JSON.parse(JSON.stringify(l.config.data)),options:{...l.config.options,maintainAspectRatio:!1,responsive:!0,animation:{duration:800,easing:"easeOutQuart"}}}))},300)}function h(){const t=document.getElementById("chart-modal");t&&(t.style.display="none",window.modalChartInstance&&(window.modalChartInstance.destroy(),window.modalChartInstance=null))}window.handleSidebarToggle=function(){const t=document.getElementById("chart-modal");t&&t.style.display!=="none"?(h(),setTimeout(()=>{window.openNav()},150)):window.openNav()};document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(t){const e=t.target.closest("canvas");if(e&&e.id.endsWith("Chart")&&e.id!=="modalChartCanvas"){const o=e.id;g(o,{tempChart:"Temperature Trend",hrChart:"Heart Rate Trend",rrChart:"Respiratory Rate Trend",bpChart:"Blood Pressure Trend",spo2Chart:"SpO2 Trend"}[o]||"Vital Trend")}}),document.getElementById("chart-modal").addEventListener("click",function(t){t.target===this&&h()})});document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".close-modal-btn")||document.getElementById("close-chart-modal");t&&t.addEventListener("click",function(){h()});const e=document.getElementById("chart-modal");e&&e.addEventListener("click",function(o){o.target===e&&h()})});document.addEventListener("DOMContentLoaded",function(){$(".modal").on("show.bs.modal",function(){closeNav()}),window.closeNav=function(){const t=document.getElementById("mySidenav");t&&(t.classList.add("-translate-x-full"),t.classList.remove("translate-x-0"))}});document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("mySidenav"),e=new MutationObserver(function(o){o.forEach(function(d){if(d.attributeName==="class"&&!t.classList.contains("-translate-x-full")){const r=document.getElementById("chart-modal");r&&r.querySelector("div"),r&&r.style.display!=="none"&&(r.style.opacity="0",h(),setTimeout(()=>{r.style.opacity="1"},300))}})});t&&e.observe(t,{attributes:!0})});window.initializeChartScrolling=function(){let t=0;const e=5,o=2,d=220,s=e-o,r=document.getElementById("chart-track"),c=document.getElementById("chart-up"),l=document.getElementById("chart-down");if(!r||!c||!l)return;function n(){r.style.transform=`translateY(${-(t*d)}px)`,c.style.opacity=t===0?"0.3":"1",l.style.opacity=t===s?"0.3":"1"}const a=c.cloneNode(!0),i=l.cloneNode(!0);c.parentNode.replaceChild(a,c),l.parentNode.replaceChild(i,l),a.addEventListener("click",()=>{t>0&&(t--,n())}),i.addEventListener("click",()=>{t<s&&(t++,n())}),t=0,n()};
