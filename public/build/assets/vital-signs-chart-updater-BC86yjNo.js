(function(){const b=document.getElementById("vitalSignChart");let c;const d=["#0D47A1","#7B1FA2","#1B5E20","#B71C1C","#37474F","#4E342E","#006064","#512DA8"],f=["06:00","08:00","12:00","14:00","18:00","20:00","00:00","02:00"],C=["TEMP","HR (bpm)","RR (bpm)","BP (mmHg)","SpOâ‚‚ (%)"];function v(e){const n=y(e);b&&(c=new Chart(b.getContext("2d"),{type:"line",data:{labels:C,datasets:n},options:{responsive:!0,animation:{duration:800,easing:"easeOutQuart"},plugins:{legend:{position:"bottom",labels:{color:"#2c3e50",font:{size:13,weight:"bold"}}},tooltip:{backgroundColor:"#333",titleColor:"#fff",bodyColor:"#f0f0f0"}},scales:{x:{ticks:{color:"#2c3e50",font:{weight:"bold"}},grid:{color:"rgba(0,0,0,0.1)"}},y:{beginAtZero:!0,ticks:{color:"#2c3e50",font:{weight:"bold"}},grid:{color:"rgba(0,0,0,0.1)"}}}}}))}function y(e){return f.map((n,r)=>{const t=e[n]||{};return{label:E(n),data:[t.temperature??null,t.hr??null,t.rr??null,t.bp??null,t.spo2??null],borderColor:d[r%d.length],backgroundColor:d[r%d.length],borderWidth:2.5,tension:0,pointRadius:4,pointHoverRadius:6,fill:!1}})}function E(e){const[n,r]=e.split(":"),t=new Date;return t.setHours(parseInt(n)),t.setMinutes(parseInt(r)),t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0})}function m(e){c&&(c.data.datasets=y(e),c.update())}window.updateVitalSignChart=m,window.initializeVitalSignChart=v,document.addEventListener("DOMContentLoaded",function(){window.initialVitalsData&&v(window.initialVitalsData);const e=document.getElementById("patient_id_hidden"),n=document.getElementById("date_selector"),r=document.getElementById("day_no_selector"),t=document.getElementById("patient-select-form");t&&t.addEventListener("submit",function(i){i.preventDefault()});async function g(){const i=e?e.value:"",o=n?n.value:"",a=r?r.value:"";if(!i){m({});return}try{const l=await fetch(t.action,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({patient_id:i,date:o,day_no:a})});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const s=await l.json();console.log("Fetched data:",s),m(s.vitalsData),w(s.vitalsData),S(s.vitalsData)}catch(l){console.error("Error fetching vital signs data:",l)}}e&&e.addEventListener("change",g),n&&n.addEventListener("change",g),r&&r.addEventListener("change",g);function w(i){f.forEach(o=>{const a=i[o]||{};document.querySelector(`input[name="temperature_${o}"]`).value=a.temperature??"",document.querySelector(`input[name="hr_${o}"]`).value=a.hr??"",document.querySelector(`input[name="rr_${o}"]`).value=a.rr??"",document.querySelector(`input[name="bp_${o}"]`).value=a.bp??"",document.querySelector(`input[name="spo2_${o}"]`).value=a.spo2??""})}function S(i){f.forEach(o=>{const a=i[o]||{},l=document.querySelector(`.alert-box[data-alert-for-time="${o}"]`);if(l){const s=a.alerts?a.alerts.split("; "):[],u=a.news_severity||"NONE";let h="",p="text-white";s.length>0&&u!=="NONE"?(h=s.join("<br>"),u==="CRITICAL"?p="text-red-600":u==="WARNING"?p="text-orange-500":u==="INFO"&&(p="text-blue-500")):h='<span class="opacity-70 text-white font-semibold">NO ALERTS</span>',l.innerHTML=`<span class="${p} font-semibold">${h}</span>`}})}})})();
