function l(){const t=document.getElementById("form-content-container");if(!t)return;const n=t.querySelector("fieldset"),r=t.querySelectorAll("textarea.notepad-lines"),o=document.querySelector('input[name="patient_id"][type="hidden"]');function a(){r.forEach(i=>{i.value=""})}function e(i){n&&(n.disabled=!i)}const d=()=>{document.querySelector('form[action*="discharge-planning"]')&&(a(),e(!1))};document.removeEventListener("patient:cleared",window.handleDischargePatientCleared),window.handleDischargePatientCleared=d,document.addEventListener("patient:cleared",window.handleDischargePatientCleared),!o||!o.value?e(!1):e(!0)}document.addEventListener("patient:selected",async t=>{if(!document.querySelector('form[action*="discharge-planning"]'))return;const{patientId:n,selectUrl:r}=t.detail,o=document.getElementById("form-content-container"),a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!(!o||!r||!n))try{const e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},body:`patient_id=${encodeURIComponent(n)}`});if(!e.ok)throw new Error(`Server responded with status: ${e.status}`);const d=await e.text(),c=new DOMParser().parseFromString(d,"text/html").getElementById("form-content-container");if(c)o.innerHTML=c.innerHTML,l(),typeof window.initSearchableDropdown=="function"&&window.initSearchableDropdown();else throw new Error("Could not find '#form-content-container' in response.")}catch(e){console.error("Patient loading failed:",e),window.location.reload()}});document.addEventListener("DOMContentLoaded",()=>{l()});
